# AIPOS ALE 改造实施计划

> **版本**: 1.0  
> **日期**: 2025年12月  
> **总工期**: 6-9个月（MVP 6周 + P1-P3 各2-3月）

---

## 1. 项目概览

### 1.1 项目目标

基于 NocoBase 1.8.31 平台，通过插件化方式实现 AIPOS ALE（Agentic Low-code Engineering）架构，对标 Palantir Foundry/AIP 本体工程能力。

### 1.2 里程碑总览

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ALE 实施里程碑                                      │
├────────────┬────────────┬────────────┬────────────┬────────────┬───────────────┤
│   M0       │    M1      │    M2      │    M3      │    M4      │     M5        │
│  准备期    │   MVP      │    P1      │    P1      │    P2      │     P3        │
│  (1周)     │  (5周)     │  (4周)     │  (4周)     │  (8周)     │   (8周)       │
├────────────┼────────────┼────────────┼────────────┼────────────┼───────────────┤
│ 环境搭建   │ 核心插件   │ 版本控制   │ Kinetic    │ Agent      │ 联邦化        │
│ 技术验证   │ 场景闭环   │ DocGen     │ 多Space    │ Studio     │ 自治运行时    │
│            │            │            │            │ Scenario   │               │
├────────────┼────────────┼────────────┼────────────┼────────────┼───────────────┤
│ Week 0     │ Week 1-6   │ Week 7-10  │ Week 11-14 │ Week 15-22 │ Week 23-30    │
└────────────┴────────────┴────────────┴────────────┴────────────┴───────────────┘
```

### 1.3 交付物清单

| 阶段 | 交付物 | 验收标准 |
|-----|-------|---------|
| M0 | 开发环境、技术验证报告 | 环境可用、验证通过 |
| M1 | MVP 可运行版本 | 延迟订单场景端到端 |
| M2 | Schema 版本控制、API 文档 | 版本管理可用 |
| M3 | Kinetic 映射、多 Space | 数据映射、租户隔离 |
| M4 | Agent Studio、Scenario | 智能体配置、仿真 |
| M5 | 联邦化、自治运行时 | 跨域协作、自动化 |

---

## 2. M0：准备阶段（Week 0，1周）

### 2.1 目标

- 搭建开发环境
- 完成技术验证
- 确定团队分工

### 2.2 任务分解

```
Week 0 (5 个工作日)
├── Day 1-2: 环境搭建
│   ├── [2h] NocoBase 开发环境配置
│   ├── [2h] PostgreSQL + Redis 本地部署
│   ├── [2h] 插件开发脚手架创建
│   └── [2h] CI/CD 流水线配置
│
├── Day 3-4: 技术验证
│   ├── [4h] NocoBase 插件机制验证（创建示例插件）
│   ├── [4h] Collection Manager 扩展验证
│   ├── [4h] Workflow 引擎扩展验证
│   └── [4h] ACL 模块扩展验证
│
└── Day 5: 规划确认
    ├── [2h] 技术验证报告编写
    ├── [2h] 团队分工确认
    ├── [2h] 详细排期确认
    └── [2h] Kickoff 会议
```

### 2.3 交付物

| 交付物 | 负责人 | 验收标准 |
|-------|-------|---------|
| 开发环境手册 | DevOps | 新成员 2h 内可搭建 |
| 插件脚手架 | 后端 Lead | `yarn create:plugin` 可用 |
| 技术验证报告 | 架构师 | 4 项验证全部通过 |
| 详细排期表 | PM | 精确到天 |

### 2.4 环境配置

```yaml
# docker-compose.dev.yml
version: "3.8"
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      - ./packages/plugins/@ale:/app/nocobase/packages/plugins/@ale
    ports:
      - "12000:13000"
    environment:
      - APP_KEY=dev-secret-key
      - DB_DIALECT=postgres
      - DB_HOST=postgres
      - DB_DATABASE=nocobase_dev
      - DB_USER=nocobase
      - DB_PASSWORD=nocobase
      - ALE_GATE_MODE=warning
      - ALE_DEBUG=true

  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: nocobase
      POSTGRES_DB: nocobase_dev
      POSTGRES_PASSWORD: nocobase
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  postgres_data:
```

---

## 3. M1：MVP 阶段（Week 1-6，5周）

### 3.1 目标

以「延迟订单处置」场景跑通完整闭环：
- 本体定义 → 门禁检查 → 变更管理 → 业务执行 → 审计追溯

### 3.2 Sprint 规划

#### Sprint 1（Week 1-2）：核心框架

```
Sprint 1 目标：ALE 核心框架可用

Week 1:
├── @ale/core 插件开发
│   ├── [8h] 插件骨架、生命周期
│   ├── [8h] 审计日志基础设施
│   ├── [8h] 上下文中间件（correlationId, spaceId）
│   └── [8h] 通用工具函数
│
├── @ale/ontology 插件开发
│   ├── [8h] ontology_objects 表设计与实现
│   ├── [8h] ontology_relations 表设计与实现
│   ├── [8h] OntologyRegistry 服务核心方法
│   └── [8h] 与 Collection Manager 集成

Week 2:
├── @ale/gate-engine 插件开发
│   ├── [8h] BaseGate 抽象类设计
│   ├── [8h] G1_STRUCTURAL 门禁实现
│   ├── [8h] G3_EVIDENCE 门禁实现
│   ├── [8h] G6_EXECUTION 门禁实现
│   ├── [8h] G7_EVALUATION 门禁实现
│   └── [8h] GateEngine 服务整合
│
├── @ale/changeset 插件开发
│   ├── [8h] changesets 表设计与实现
│   ├── [8h] ChangeSetService 核心方法
│   ├── [8h] 与 GateEngine 集成
│   └── [8h] 审批流程基础实现

Sprint 1 交付物:
- [ ] @ale/core v0.1.0
- [ ] @ale/ontology v0.1.0
- [ ] @ale/gate-engine v0.1.0
- [ ] @ale/changeset v0.1.0
- [ ] 单元测试覆盖率 ≥80%
```

#### Sprint 2（Week 3-4）：场景实现

```
Sprint 2 目标：延迟订单处置场景核心功能

Week 3:
├── 数据模型实现
│   ├── [8h] disposal_orders 表设计与实现
│   ├── [8h] disposal_evidences 表设计与实现
│   ├── [8h] disposal_events 表设计与实现
│   └── [8h] 本体注册（对象+关系）
│
├── 状态机实现
│   ├── [8h] 状态机定义与配置
│   ├── [8h] 状态转换规则
│   ├── [8h] 与 Workflow 集成
│   └── [8h] 门禁绑定

Week 4:
├── 动作实现
│   ├── [8h] assign 动作（分配处置单）
│   ├── [8h] submitProposal 动作（提交方案）
│   ├── [8h] approve 动作（审批）
│   ├── [8h] execute 动作（执行处置）
│   └── [8h] 事件记录与审计
│
├── API 实现
│   ├── [8h] RESTful API 端点
│   ├── [8h] 请求/响应格式
│   └── [8h] 错误处理

Sprint 2 交付物:
- [ ] @ale/disposal-order v0.1.0
- [ ] 场景 API 文档
- [ ] 集成测试通过
```

#### Sprint 3（Week 5-6）：UI 与闭环

```
Sprint 3 目标：端到端闭环可演示

Week 5:
├── 前端开发
│   ├── [12h] 处置单列表页
│   ├── [12h] 处置单详情页
│   ├── [12h] 处置单表单（创建/编辑）
│   └── [12h] 审批页面
│
├── ChangeSet 流程完善
│   ├── [8h] 审批流程 UI
│   ├── [8h] 门禁报告展示
│   └── [8h] 回滚功能

Week 6:
├── 集成与测试
│   ├── [8h] 端到端测试编写
│   ├── [8h] 性能测试
│   ├── [8h] Bug 修复
│   └── [8h] 文档完善
│
├── 演示准备
│   ├── [4h] 演示数据准备
│   ├── [4h] 演示脚本编写
│   ├── [4h] 部署到 Staging
│   └── [4h] MVP 演示会

Sprint 3 交付物:
- [ ] 可演示的 MVP 版本
- [ ] 用户手册（初版）
- [ ] 部署手册
- [ ] MVP 总结报告
```

### 3.3 MVP 验收标准

| 功能点 | 验收标准 | 优先级 |
|-------|---------|-------|
| 本体定义 | 处置单对象在本体注册表可查 | P0 |
| 门禁检查 | G1/G3/G6/G7 门禁正常工作 | P0 |
| ChangeSet | 创建→提交→审批→发布→回滚 流程跑通 | P0 |
| 状态机 | 6 个状态、8 个转换正常工作 | P0 |
| 动作执行 | 4 个核心动作通过门禁并执行 | P0 |
| 审计追溯 | 任意操作可追溯到人、时间、证据 | P0 |
| UI 可用 | 列表、详情、表单、审批页面可用 | P1 |
| 性能达标 | API P99 ≤500ms，门禁 ≤200ms | P1 |

---

## 4. M2：P1 阶段 - 版本控制（Week 7-10，4周）

### 4.1 目标

- Schema 版本控制
- 差异比对与合并
- API 文档自动生成（DocGen）

### 4.2 任务分解

```
Week 7-8: Schema 版本控制
├── 版本管理服务
│   ├── [16h] schema_versions 表设计
│   ├── [16h] 版本快照创建
│   ├── [16h] 版本差异比对
│   └── [16h] 版本回滚实现
│
├── 与 ChangeSet 集成
│   ├── [8h] ChangeSet 版本字段
│   ├── [8h] 发布时创建版本快照
│   └── [8h] 回滚时恢复版本

Week 9-10: DocGen
├── API 文档生成
│   ├── [16h] OpenAPI 规范生成
│   ├── [16h] 从本体生成 API 文档
│   └── [8h] Swagger UI 集成
│
├── 对象文档生成
│   ├── [8h] 对象 Schema 文档
│   ├── [8h] 关系图生成
│   └── [8h] 门禁规则文档
│
├── UI 开发
│   ├── [8h] 版本历史页面
│   ├── [8h] 差异查看页面
│   └── [8h] 文档查看页面
```

### 4.3 交付物

| 交付物 | 验收标准 |
|-------|---------|
| @ale/versioning v0.1.0 | 版本管理功能可用 |
| @ale/docgen v0.1.0 | API 文档自动生成 |
| 版本管理 UI | 可查看历史、比对差异 |

---

## 5. M3：P1 阶段 - Kinetic 与 Space（Week 11-14，4周）

### 5.1 目标

- Kinetic 映射运行时
- 多 Space 租户隔离

### 5.2 任务分解

```
Week 11-12: Kinetic 映射
├── 映射引擎
│   ├── [16h] kinetic_mappings 表设计
│   ├── [16h] 映射规范解析器
│   ├── [16h] 增量刷新调度器
│   └── [16h] 血缘记录
│
├── 虚拟表
│   ├── [8h] 投影视图创建
│   ├── [8h] 缓存策略
│   └── [8h] 质量规则检查

Week 13-14: 多 Space
├── Space 管理
│   ├── [16h] spaces 表设计
│   ├── [16h] Space CRUD 服务
│   ├── [16h] 权限隔离中间件
│   └── [8h] 跨 Space 引用控制
│
├── UI 开发
│   ├── [8h] Space 管理页面
│   ├── [8h] Space 切换组件
│   └── [8h] 映射配置页面
```

### 5.3 交付物

| 交付物 | 验收标准 |
|-------|---------|
| @ale/kinetic v0.1.0 | 数据映射可配置、可刷新 |
| @ale/space v0.1.0 | 租户隔离生效 |
| 映射管理 UI | 可配置映射、查看血缘 |
| Space 管理 UI | 可创建、切换 Space |

---

## 6. M4：P2 阶段 - Agent Studio（Week 15-22，8周）

### 6.1 目标

- Agent Studio 智能体配置平台
- Scenario 仿真沙箱
- RAG 检索集成

### 6.2 任务分解

```
Week 15-18: Agent Studio
├── Week 15-16: 智能体配置
│   ├── [24h] agents 表设计与服务
│   ├── [24h] 上下文绑定（Ontology Context）
│   ├── [24h] 工具白名单配置
│   └── [24h] 门禁/评测绑定
│
├── Week 17-18: 发布与监控
│   ├── [16h] 影子模式实现
│   ├── [16h] 审批发布流程
│   ├── [16h] 运行监控
│   └── [16h] Agent Studio UI

Week 19-20: Scenario 沙箱
├── 仿真环境
│   ├── [16h] 数据快照机制
│   ├── [16h] 模拟执行引擎
│   ├── [16h] 影响分析
│   └── [16h] ChangeSet 转换
│
├── UI 开发
│   ├── [8h] 仿真配置页面
│   ├── [8h] 执行结果展示
│   └── [8h] 影响分析可视化

Week 21-22: RAG 集成
├── 向量存储
│   ├── [16h] pgvector 集成
│   ├── [16h] 对象向量化
│   ├── [8h] 混合检索 API
│   └── [8h] Agent 上下文注入
│
├── 测试与优化
│   ├── [16h] 集成测试
│   ├── [8h] 性能优化
│   └── [8h] 文档完善
```

### 6.3 交付物

| 交付物 | 验收标准 |
|-------|---------|
| @ale/agent-studio v0.1.0 | 智能体配置、发布可用 |
| @ale/scenario v0.1.0 | 仿真执行可用 |
| @ale/rag v0.1.0 | 语义检索可用 |
| Agent Studio UI | 完整配置流程 |

---

## 7. M5：P3 阶段 - 联邦化（Week 23-30，8周）

### 7.1 目标

- 跨域 Space 协作
- 多 Agent 编排
- 自治运行时

### 7.2 任务分解

```
Week 23-26: 联邦化
├── Week 23-24: 跨域协作
│   ├── [24h] 跨 Space 事件总线
│   ├── [24h] 引用访问控制
│   ├── [24h] 资产复制机制
│   └── [24h] 联邦查询
│
├── Week 25-26: Ontology IR
│   ├── [16h] 中间表示设计
│   ├── [16h] 导出/导入工具
│   ├── [16h] 版本兼容
│   └── [16h] 适配器标准化

Week 27-30: 自治运行时
├── Week 27-28: 多 Agent 编排
│   ├── [24h] Agent 编排引擎
│   ├── [24h] 策略自动生成
│   ├── [16h] 冲突解决机制
│   └── [16h] 编排 DSL
│
├── Week 29-30: 自治能力
│   ├── [16h] 在线退化监控
│   ├── [16h] 自动降级机制
│   ├── [16h] 告警与恢复
│   ├── [16h] 最终测试
│   └── [16h] GA 准备
```

### 7.3 交付物

| 交付物 | 验收标准 |
|-------|---------|
| @ale/federation v0.1.0 | 跨域协作可用 |
| @ale/orchestration v0.1.0 | 多 Agent 编排 |
| @ale/autonomy v0.1.0 | 自治运行时 |
| ALE v1.0.0 GA | 全功能可用 |

---

## 8. 团队配置

### 8.1 核心团队

| 角色 | 人数 | 职责 | 投入度 |
|-----|-----|-----|-------|
| 技术负责人/架构师 | 1 | 架构设计、技术决策、代码评审 | 100% |
| 后端工程师（高级） | 2 | 核心插件开发、门禁引擎 | 100% |
| 后端工程师（中级） | 1 | 业务场景开发、API 实现 | 100% |
| 前端工程师 | 1 | UI 开发、组件封装 | 100% |
| QA 工程师 | 0.5 | 测试策略、自动化测试 | 50% |
| DevOps | 0.5 | CI/CD、环境管理 | 50% |

### 8.2 扩展团队（P2/P3）

| 角色 | 人数 | 加入时间 |
|-----|-----|---------|
| AI/ML 工程师 | 1 | P2 开始 |
| 后端工程师 | 1 | P2 开始 |

### 8.3 职责矩阵

```
                    ┌─────────────────────────────────────────────────────┐
                    │                    角色矩阵                          │
┌───────────────────┼─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────────┤
│ 模块              │ 架构│ 后端│ 后端│ 后端│ 前端│ QA  │DevOp│ AI/ML   │
│                   │     │ 高级│ 高级│ 中级│     │     │     │         │
├───────────────────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────────┤
│ @ale/core         │  R  │  A  │  C  │     │     │  C  │     │         │
│ @ale/ontology     │  R  │  A  │     │     │     │  C  │     │         │
│ @ale/gate-engine  │  R  │     │  A  │     │     │  C  │     │         │
│ @ale/changeset    │  R  │     │  A  │     │     │  C  │     │         │
│ @ale/disposal-ord │  C  │     │     │  A  │  C  │  C  │     │         │
│ 前端 UI           │  C  │     │     │  C  │  A  │  C  │     │         │
│ CI/CD             │  C  │     │     │     │     │     │  A  │         │
│ @ale/rag          │  R  │     │     │     │     │  C  │     │    A    │
│ @ale/agent-studio │  R  │  A  │     │     │  C  │  C  │     │    C    │
├───────────────────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────────┤
│ R = Responsible (负责执行)  A = Accountable (最终责任)               │
│ C = Consulted (咨询)        I = Informed (知会)                      │
└───────────────────────────────────────────────────────────────────────┘
```

---

## 9. 风险管理

### 9.1 风险登记册

| ID | 风险描述 | 概率 | 影响 | 等级 | 缓解措施 | 负责人 |
|----|---------|-----|-----|-----|---------|-------|
| R1 | NocoBase 版本升级导致不兼容 | 中 | 高 | 高 | 锁定版本、建立回归测试 | 架构师 |
| R2 | 门禁性能不达标 | 高 | 中 | 高 | 缓存策略、并行评估 | 后端高级 |
| R3 | 团队对 Palantir 概念理解不足 | 中 | 中 | 中 | 培训、文档、渐进实施 | 架构师 |
| R4 | MVP 范围蔓延 | 高 | 中 | 高 | 严格范围控制、优先级管理 | PM |
| R5 | 外部依赖（AI API）不稳定 | 低 | 中 | 中 | 降级策略、多供应商 | 后端 |
| R6 | 人员变动 | 低 | 高 | 中 | 知识共享、文档完善 | TL |

### 9.2 应急预案

#### 场景 1：MVP 延期

**触发条件**：Sprint 2 结束时进度落后 >30%

**应对措施**：
1. 砍掉 P1 功能（UI 美化、非核心动作）
2. 增加人力（借调 1 名后端）
3. 延长 MVP 周期 1 周

#### 场景 2：性能不达标

**触发条件**：门禁评估 P99 >500ms

**应对措施**：
1. 启用门禁缓存
2. 减少门禁数量（仅 G1/G6）
3. 异步门禁评估

#### 场景 3：NocoBase 严重 Bug

**触发条件**：NocoBase 内核 Bug 阻塞开发

**应对措施**：
1. 提交 Issue/PR 给 NocoBase 社区
2. 本地 Patch 临时修复
3. 评估是否需要 Fork

---

## 10. 沟通计划

### 10.1 会议安排

| 会议类型 | 频率 | 参与者 | 时长 | 目的 |
|---------|-----|-------|-----|-----|
| 每日站会 | 每日 | 开发团队 | 15min | 进度同步、障碍识别 |
| Sprint 评审 | 每2周 | 全员+利益相关方 | 1h | 演示成果、收集反馈 |
| Sprint 回顾 | 每2周 | 开发团队 | 1h | 持续改进 |
| 技术评审 | 按需 | 架构师+相关开发 | 1-2h | 设计评审、代码评审 |
| 周报 | 每周 | PM→管理层 | 文档 | 进度汇报 |

### 10.2 沟通渠道

| 渠道 | 用途 | 响应时间 |
|-----|-----|---------|
| 企业微信群 | 日常沟通、快速问题 | 4h 内 |
| GitHub Issues | Bug 跟踪、功能请求 | 1 工作日 |
| Confluence | 文档、设计方案 | 异步 |
| 周报邮件 | 正式汇报 | 周五发送 |

---

## 11. 质量保障

### 11.1 代码质量

```yaml
# 代码质量门禁
code_quality:
  lint:
    tool: eslint
    rules: "@nocobase/eslint-config"
    threshold: 0 errors
    
  test_coverage:
    unit: ≥80%
    integration: ≥60%
    
  code_review:
    required_approvers: 1
    require_ci_pass: true
    
  security_scan:
    tool: snyk
    threshold: no high/critical
```

### 11.2 测试策略

| 测试类型 | 工具 | 覆盖范围 | 执行时机 |
|---------|-----|---------|---------|
| 单元测试 | Vitest | 服务、工具函数 | 每次提交 |
| 集成测试 | Vitest + Supertest | API、数据库 | 每次提交 |
| E2E 测试 | Playwright | 关键用户路径 | 每日/发布前 |
| 性能测试 | k6 | API 性能 | 每周/发布前 |
| 安全扫描 | Snyk | 依赖漏洞 | 每日 |

### 11.3 发布检查清单

```markdown
## 发布前检查清单

### 代码质量
- [ ] 所有测试通过
- [ ] 代码覆盖率达标
- [ ] 无 Lint 错误
- [ ] 安全扫描无高危

### 功能验证
- [ ] 新功能手动验证
- [ ] 回归测试通过
- [ ] 性能测试达标

### 文档
- [ ] API 文档更新
- [ ] 变更日志更新
- [ ] 用户手册更新（如需）

### 部署
- [ ] 数据库迁移脚本测试
- [ ] 配置变更确认
- [ ] 回滚方案准备
- [ ] 监控告警确认

### 审批
- [ ] 技术负责人审批
- [ ] 产品负责人确认
```

---

## 12. 预算估算

### 12.1 人力成本

| 阶段 | 人月 | 单价(万/月) | 小计(万) |
|-----|-----|-----------|---------|
| M0 准备期 | 4 | 4 | 16 |
| M1 MVP | 25 | 4 | 100 |
| M2 P1-版本 | 16 | 4 | 64 |
| M3 P1-Kinetic | 16 | 4 | 64 |
| M4 P2 | 40 | 4 | 160 |
| M5 P3 | 40 | 4 | 160 |
| **合计** | **141** | - | **564** |

### 12.2 基础设施成本

| 资源 | 规格 | 单价(万/月) | 月数 | 小计(万) |
|-----|-----|-----------|-----|---------|
| 开发环境 | 4C8G x 2 | 0.1 | 9 | 0.9 |
| Staging | 4C16G x 2 | 0.15 | 9 | 1.35 |
| 生产环境 | 8C32G x 3 | 0.4 | 6 | 2.4 |
| PostgreSQL | 4C16G | 0.08 | 9 | 0.72 |
| Redis | 4G | 0.03 | 9 | 0.27 |
| AI API | 按量 | 0.15 | 9 | 1.35 |
| **合计** | - | - | - | **7** |

### 12.3 总预算

| 类别 | 金额(万) |
|-----|---------|
| 人力成本 | 564 |
| 基础设施 | 7 |
| 软件许可 | 5 |
| 培训/差旅 | 10 |
| 应急储备 (10%) | 58.6 |
| **总计** | **644.6** |

---

## 附录 A：详细排期表

### MVP 阶段甘特图

```
Week    1    2    3    4    5    6
        ├────┼────┼────┼────┼────┤
@ale/core
        ████
@ale/ontology
        ████
@ale/gate
             ████
@ale/changeset
             ████
数据模型
                  ████
状态机
                  ████
动作实现
                       ████
API 实现
                       ████
前端 UI
                            ████████
测试
                            ████████
演示
                                 ████
```

### 关键里程碑

| 里程碑 | 日期 | 交付物 |
|-------|-----|-------|
| M0 完成 | Week 0 结束 | 环境就绪、验证通过 |
| Sprint 1 完成 | Week 2 结束 | 核心框架可用 |
| Sprint 2 完成 | Week 4 结束 | 场景功能可用 |
| MVP 演示 | Week 6 结束 | 端到端闭环 |
| P1 完成 | Week 14 结束 | 版本控制+Kinetic |
| P2 完成 | Week 22 结束 | Agent Studio |
| GA 发布 | Week 30 结束 | v1.0.0 |

---

**文档状态**：草案  
**最后更新**：2025年12月  
**下次评审**：M0 完成后
